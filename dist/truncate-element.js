(()=>{"use strict";class t{constructor(t){}}class i{constructor(t){this.word="",this.length=0,this.type="simple",this.html="",this.word=t,this.length=t.length}}class e{constructor(t){this.Number=t}cut(t){let i=0;for(i=this.Number;i<t.length&&" "!=t[i];i++);return t.substring(0,i)}}class n extends t{constructor(t){super(t),this.LinkCount=0,this.LinkList=[],t.identifyLink?this.IdentifyLink=t.identifyLink:this.IdentifyLink={enabled:!1}}process(t){let i,e,n="(ftp:\\/\\/|(https?:)\\/\\/(www\\.)?|www\\.)",h="",s="\\w+";for(this.IdentifyLink.protocol&&this.IdentifyLink.protocol.length>0&&(n=this.recognizingProtocol()),this.IdentifyLink.domain&&this.IdentifyLink.domain.length>0&&(h=this.recongnizingDomain()),this.IdentifyLink.hasQueryString&&(s="(((\\:|\\/|\\?){1}\\S*)*|\\w+)+"),i=new RegExp(`(^|[ ])${n}[0-9a-zA-Z]([-.\\w]+)${h}${s}`,"gm");null!==(e=i.exec(t.word));){this.LinkList.push(e[0]);let i=e[0];"www"===e[0].substring(0,3)&&(i="http://"+e[0]),t.html=`<a href=${i} ${this.IdentifyLink.target?"target="+this.IdentifyLink.target:""} ${this.IdentifyLink.title?"title="+this.IdentifyLink.title:""} ${this.IdentifyLink.class?'class="'+this.IdentifyLink.class+'"':""} ${this.IdentifyLink.style?"style="+this.IdentifyLink.style:""}>${t.html?t.html:t.word}</a>`,t.type+=" link"}return t}recognizingProtocol(){if(this.IdentifyLink.protocol&&this.IdentifyLink.protocol.length>0){this.IdentifyLink.protocol=this.IdentifyLink.protocol.sort();let t=[];return this.IdentifyLink.protocol.find((t=>"ftp"===t))&&t.push("ftp:\\/\\/"),this.IdentifyLink.protocol.find((t=>"http"===t))&&t.push("http:\\/\\/(www\\.)?"),this.IdentifyLink.protocol.find((t=>"https"===t))&&t.push("https:\\/\\/(www\\.)?"),this.IdentifyLink.protocol.find((t=>"www"===t))&&t.push("www\\.?"),"("+t.join("|")+")"}return""}recongnizingDomain(){return this.IdentifyLink.domain?"("+this.IdentifyLink.domain.join("|")+")":""}}class h extends t{process(t){return/(^|\s)(@[^\d\.\s](\w{1,30}|\.)+)$/gim.test(t.word)&&(t.type+=" mention",t.html=`<span class=mention style=color:#0095f6>${t.html?t.html:t.word}</span>`),t}}class s extends t{process(t){return/(^|\s)(#[\p{Pc}\p{N}\p{L}\u200cÀ-ÖØ-öø-ʸ(_)]+)$/gimu.test(t.word)&&(t.html=`<span class=hashtag style=color:#1b95e0>${t.html?t.html:t.word}</span>`,t.type+=" hashtag"),t}}class o extends t{constructor(t){super(t),window.highlight=this,t.highlightList?this.highlightQuery=t.highlightList.map((t=>{let i={};return this.instanceOfHighlighQuery(t)?(i.name=t.name,i.color=t.color):(i.name=t,i.color="yellow"),i.tag="",i.index=0,i.existInAnotherQuery=!1,i})):this.highlightQuery=[],this.highlightCondition=t.highlightCondition,this.highlightQuery.length&&this.highlightQuery.sort(((t,i)=>t.name.length-i.name.length)),this.nestedHighlightArray=this.findHighlightInAnother()}process(t){if(!this.highlightQuery||!this.highlightQuery.length)return t;if("exactly"==this.highlightCondition){for(let i of this.highlightQuery){if(i.name.length>t.length)continue;const e="(^|(?<!\\p{L}))("+i.name+")(?!(\\p{L}))",n=new RegExp(e,"gmu");return n.test(t.word)&&(n.lastIndex=0,t.html=this.createTag(i.color,i.name),t.type=t.type.concat(" highlight")),t}return t}if(this.nestedHighlightArray.length||this.highlightQuery.length){for(const i of this.nestedHighlightArray){const e=new RegExp(i.parent,"gmi");e.test(t.word)&&(e.lastIndex=0,t.html=t.word.replace(new RegExp(i.parent,"gm"),i.parentTag)),this.highlightQuery=this.highlightQuery.filter((t=>!t.existInAnotherQuery)).filter((t=>t.name!=i.parent))}for(const i of this.highlightQuery){const e=new RegExp(i.name,"gmi");if(e.test(t.word))if(e.lastIndex=0,t.html){let e=t.html.split(i.name);for(let t=0;t<e.length&&t!=e.length-1;t++)e[t]=e[t]+i.tag;t.html=e.join("")}else t.html=t.word.replace(new RegExp(i.name,"gmu"),(t=>`<span style="background:${i.color}">${t}</span>`))}return t.html?(t.type=t.type.concat(" highlight"),t):t}return t}instanceOfHighlighQuery(t){return"string"!=typeof t&&"name"in t}createTag(t,i){return`<span style="background:${t}">${i}</span>`}findHighlightInAnother(){const t=[];return this.highlightQuery.forEach((i=>{for(let e=0;e<this.highlightQuery.length;e++){const n=this.highlightQuery[e];if(i.name.length>=n.name.length)i.tag=this.createTag(i.color,i.name),i.existInAnotherQuery=!1;else if(n.name.includes(i.name)){i.existInAnotherQuery=!0;const e=t.find((t=>t.parent==n.name));if(e)i.tag=this.createTag(i.color,i.name),i.index=n.name.indexOf(i.name),e.children.push(i);else{const e={parent:"",parentTag:"",children:[]};e.parent=n.name,i.tag=this.createTag(i.color,i.name),i.index=n.name.indexOf(i.name),e.children.push(i),t.push(e)}}}})),t.forEach((t=>{let i=t.parent;t.children.sort(((t,i)=>t.index-i.index)).forEach(((e,n)=>{const h=new RegExp(e.name,"gm"),s=0==n?i.indexOf(e.name):t.children[n-1].tag.length;i=this.replaceAfterIndex(i,h,e.tag,s)})),t.parentTag=this.createTag(this.highlightQuery.find((i=>i.name==t.parent)).color,i)})),t}replaceAfterIndex(t,i,e,n){return t.length>n?t.slice(0,n)+t.slice(n).replace(i,e):t}}class r extends t{process(t){return new i(t)}}class l extends HTMLElement{constructor(){super(),this._highlightQuery=[],this.config={number:0,more:"",less:"",completeWord:!1,hashtag:!1,hasLiteral:!1,highlightCondition:"exactly",highlightList:[{name:"",color:""}],mention:!1},this.number=100,this.more="show",this.less="hide",this.completeWord=!1,this.hashtag=!1,this.hasLiteral=!1,this.highlightCondition="exactly",this.highlightList=[{name:"",color:""}],this.text="",this.truncated=!1,this.mention=!1,this.identifyLink={hasQueryString:!1,title:"",class:"",style:"text-decoration:none;color:blue;",domain:[],protocol:[],target:"_blank",enabled:!1},this.userModels=[],this.linkList=[],this.linkCount=0,this.hashtagCount=0,this.mentionCount=0,this.replaceString="***",this.connectedLoaded=!1,this.dataLoaded=!1,this.tempHtml="",this.wordArray=[],this.remainText="",this.fullText="",window.trun=this,new MutationObserver((()=>{this.connectedLoaded&&!this.dataLoaded&&this.initialValues()})).observe(this,{characterData:!1,childList:!0,attributes:!1})}addUserModel(...t){this.userModels.push(...t.map((t=>({model:t}))))}connectedCallback(){setTimeout((()=>{this.initialValues()}),0),this.connectedLoaded=!0}attributeChangedCallback(t,i,e){this.connectedLoaded&&this.initialValues(t)}static get observedAttributes(){return["config"]}initialValues(t="config"){if(!this.innerHTML)return;this.tempHtml||(this.tempHtml=this.innerHTML);const i=this.getAttribute(t);(null==i?void 0:i.length)&&(this.config=JSON.parse(i),this.number=this.config.number?this.config.number:this.number,this.more=this.config.more?this.config.more:this.more,this.less=this.config.less?this.config.less:this.less,this._highlightQuery=this.config.highlightList?this.config.highlightList:this._highlightQuery,this.highlightCondition=this.config.highlightCondition?this.config.highlightCondition:this.highlightCondition,this.completeWord=this.config.completeWord?this.config.completeWord:this.completeWord,this.hashtag=this.config.hashtag?this.config.hashtag:this.hashtag,this.hasLiteral=this.config.hasLiteral?this.config.hasLiteral:this.hasLiteral,this.mention=this.config.mention?this.config.mention:this.mention,this.config.identifyLink&&(this.identifyLink.enabled=this.config.identifyLink.enabled,this.identifyLink.title=this.config.identifyLink.title?this.config.identifyLink.title:this.identifyLink.title,this.identifyLink.class=this.config.identifyLink.class?this.config.identifyLink.class:this.identifyLink.class,this.identifyLink.style=this.config.identifyLink.style?this.config.identifyLink.style:this.identifyLink.style,this.identifyLink.domain=this.config.identifyLink.domain?this.config.identifyLink.domain:this.identifyLink.domain,this.identifyLink.protocol=this.config.identifyLink.protocol?this.config.identifyLink.protocol:this.identifyLink.protocol,this.identifyLink.target=this.config.identifyLink.target?this.config.identifyLink.target:this.identifyLink.target,this.identifyLink.hasQueryString=this.config.identifyLink.hasQueryString?this.config.identifyLink.hasQueryString:this.identifyLink.hasQueryString),this.main(this.tempHtml),this.dataLoaded=!0)}main(t){var i,l,a;this.hasLiteral||(t=t.replace(/(\r\n\t|\r\n|\n|\r\t)/gm," ")),this.text=t,this.wordArray=t.split(" ").filter((t=>!!this.hasLiteral||t.length>0));const g=[],c=[],d=new r(this.config);for(const t of this.wordArray)c.push(d.process(t));(null===(i=this.config.highlightList)||void 0===i?void 0:i.length)&&g.push({model:o}),(null===(l=this.config.identifyLink)||void 0===l?void 0:l.enabled)&&g.push({model:n}),this.config.hashtag&&g.push({model:s}),this.config.mention&&g.push({model:h}),(null===(a=this.userModels)||void 0===a?void 0:a.length)&&this.userModels.forEach((t=>{g.push(t)}));for(let t of c)for(const i of g){const e=new i.model(this.config);0!=t.length&&(t=e.process(t))}if(t.length>this.number){this.truncated=!0;const i=new e(this.number);t=this.completeWord?i.cut(t):t.substring(0,this.number)}c.length?(this.remainText=c.slice(0,t.split(" ").length).map((t=>t.html?t.html:t.word)).join(" ")+" ... ",this.fullText=c.map((t=>t.html?t.html:t.word)).join(" ")):(this.remainText=t+" ... ",this.fullText=this.text),this.truncated?this.initialText(this.remainText,this.more):this.initialText(this.fullText),this.hasLiteral&&(this.style.whiteSpace="pre-line")}initialText(t,i){if(i){const e=this.createSpan(i);this.innerHTML=t,this.appendChild(e)}else this.innerHTML=t}showText(t,i){this.truncated=!this.truncated;const e=this.createSpan(this.truncated?this.more:this.less);this.innerHTML=t,this.hasLiteral&&(this.style.whiteSpace="pre-line"),i.stopPropagation(),this.appendChild(e)}createSpan(t){const i=document.createElement("span");return i.innerHTML=" "+t,i.style.color="#ff00ff",i.style.cursor="pointer",i.classList.add("toggleText"),i.addEventListener("click",(t=>this.showText(this.truncated?this.fullText:this.remainText,t))),i}}customElements.get("truncate-element")||customElements.define("truncate-element",l)})();
//# sourceMappingURL=truncate-element.js.map