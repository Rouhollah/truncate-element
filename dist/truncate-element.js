!function(i){var t={};function e(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return i[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}e.m=i,e.c=t,e.d=function(i,t,n){e.o(i,t)||Object.defineProperty(i,t,{enumerable:!0,get:n})},e.r=function(i){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(i,"__esModule",{value:!0})},e.t=function(i,t){if(1&t&&(i=e(i)),8&t)return i;if(4&t&&"object"==typeof i&&i&&i.__esModule)return i;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:i}),2&t&&"string"!=typeof i)for(var s in i)e.d(n,s,function(t){return i[t]}.bind(null,s));return n},e.n=function(i){var t=i&&i.__esModule?function(){return i.default}:function(){return i};return e.d(t,"a",t),t},e.o=function(i,t){return Object.prototype.hasOwnProperty.call(i,t)},e.p="",e(e.s=0)}([function(i,t,e){"use strict";e.r(t),e.d(t,"TruncateElement",(function(){return n}));class n extends HTMLElement{constructor(){super(),this._highlightQuery=[],this.config={number:0,more:"",less:"",completeWord:!1,hashtag:!1,hasLiteral:!1,highlightCondition:"exactly",highlightList:[{name:"",color:""}],mention:!1},this.number=100,this.more="show",this.less="hide",this.completeWord=!1,this.hashtag=!1,this.hasLiteral=!1,this.highlightCondition="exactly",this.highlightList=[{name:"",color:""}],this.text="",this.replace=!1,this.mention=!1,this.identifyLink={hasQueryString:!1,title:"",class:"",style:"text-decoration:none;color:blue;",domain:[],protocol:[],target:"_blank",enabled:!1},this.linkList=[],this.linkCount=0,this.hashtagCount=0,this.mentionCount=0,this.replaceString="***",this.connectedLoaded=!1,this.dataLoaded=!1,this.tempHtml="",window.trun=this;new MutationObserver(()=>{this.connectedLoaded&&!this.dataLoaded&&this.initialValues()}).observe(this,{characterData:!1,childList:!0,attributes:!1})}instanceOfHighlighQuery(i){return"string"!=typeof i&&"name"in i}connectedCallback(){this.initialValues(),this.connectedLoaded=!0}attributeChangedCallback(i,t,e){this.connectedLoaded&&this.initialValues(i)}static get observedAttributes(){return["config"]}initialValues(i="config"){if(!this.innerHTML)return;this.tempHtml||(this.tempHtml=this.innerHTML);const t=this.getAttribute(i);(null==t?void 0:t.length)&&(this.config=JSON.parse(t),this.number=this.config.number?this.config.number:this.number,this.more=this.config.more?this.config.more:this.more,this.less=this.config.less?this.config.less:this.less,this._highlightQuery=this.config.highlightList?this.config.highlightList:this._highlightQuery,this.highlightCondition=this.config.highlightCondition?this.config.highlightCondition:this.highlightCondition,this.completeWord=this.config.completeWord?this.config.completeWord:this.completeWord,this.hashtag=this.config.hashtag?this.config.hashtag:this.hashtag,this.hasLiteral=this.config.hasLiteral?this.config.hasLiteral:this.hasLiteral,this.mention=this.config.mention?this.config.mention:this.mention,this.config.identifyLink&&(this.identifyLink.enabled=this.config.identifyLink.enabled,this.identifyLink.title=this.config.identifyLink.title?this.config.identifyLink.title:this.identifyLink.title,this.identifyLink.class=this.config.identifyLink.class?this.config.identifyLink.class:this.identifyLink.class,this.identifyLink.style=this.config.identifyLink.style?this.config.identifyLink.style:this.identifyLink.style,this.identifyLink.domain=this.config.identifyLink.domain?this.config.identifyLink.domain:this.identifyLink.domain,this.identifyLink.protocol=this.config.identifyLink.protocol?this.config.identifyLink.protocol:this.identifyLink.protocol,this.identifyLink.target=this.config.identifyLink.target?this.config.identifyLink.target:this.identifyLink.target,this.identifyLink.hasQueryString=this.config.identifyLink.hasQueryString?this.config.identifyLink.hasQueryString:this.identifyLink.hasQueryString),this._highlightQuery&&this._highlightQuery.length&&this._highlightQuery.sort((i,t)=>{if(this.instanceOfHighlighQuery(i)&&this.instanceOfHighlighQuery(t)){if(i.name&&t.name)return i.name.length-t.name.length}else if("string"==typeof i&&this.instanceOfHighlighQuery(t)){if(t.name)return i.length-t.name.length}else{if(!this.instanceOfHighlighQuery(t)||"string"!=typeof i)return"string"==typeof t&&"string"==typeof i?i.length-t.length:0;if(t.name)return i.length-t.name.length}return 0}),this.main(this.tempHtml),this.dataLoaded=!0)}main(i){this.hasLiteral||(i=i.replace(/(\r\n\t|\n|\r\t)/gm," ")),this.text=i;let t="";if(i.length>this.number){t=this.cutFindHighlight(this.completeWord,this.hashtag,this.mention,i,this.highlightCondition,this._highlightQuery,this.number),this.replace=!0,this.innerHTML=t+" ... ";const e=document.createElement("span");e.innerHTML=this.more,e.style.color="#ff00ff",e.style.cursor="pointer",e.classList.add("toggleText"),this.innerHTML=t+"... ",e.addEventListener("click",i=>!0===this.replace?this.showFullText(i):this.hideSomeText(i)),this.appendChild(e)}else i=this.cutFindHighlight(this.completeWord,this.hashtag,this.mention,i,this.highlightCondition,this._highlightQuery),this.innerHTML=i;this.hasLiteral&&(this.style.whiteSpace="pre-line")}showFullText(i){const t=document.createElement("span");t.innerHTML=" "+this.less,t.style.color="#ff00ff",t.style.cursor="pointer",t.classList.add("toggleText"),this.innerHTML=this.cutFindHighlight(this.completeWord,this.hashtag,this.mention,this.text,this.highlightCondition,this._highlightQuery),this.hasLiteral&&(this.style.whiteSpace="pre-line"),t.addEventListener("click",i=>this.hideSomeText(i)),this.appendChild(t),i.stopPropagation(),this.replace=!1}hideSomeText(i){const t=this.cutFindHighlight(this.completeWord,this.hashtag,this.mention,this.text,this.highlightCondition,this._highlightQuery,this.number),e=document.createElement("span");e.style.color="#ff00ff",e.classList.add("toggleText"),e.innerHTML=this.more,this.innerHTML=t+" ... ",this.hasLiteral&&(this.style.whiteSpace="pre-line"),e.addEventListener("click",i=>this.showFullText(i)),this.appendChild(e),i.stopPropagation(),this.replace=!0}cutFindHighlight(i,t,e,n,s="exactly",h=[],o){return o&&(n=i?this.checkWordCut(o,n):n.substring(0,o)),this.identifyLink.enabled&&(n=this.linkIdentify(n)),n=t?this.findHashtag(n):n,n=e?this.findMention(n):n,n=this.highlight(n,s,h),this.linkList.length>0&&(n=this.linkList.reduce((i,t,e)=>{const n=t.includes("http")?t.trimStart():"https://"+t.trimStart(),s=this.identifyLink.target?this.identifyLink.target:"_blank",h=this.identifyLink.title?this.identifyLink.title:"",o=this.identifyLink.class?this.identifyLink.class:"",r=this.identifyLink.style?this.identifyLink.style:"";return i.replace(`${this.replaceString}${e}${this.replaceString}`,`<a href="${n}" target="${s}" title="${h}" style="${r}" class="${o}">${t}</a>`)},n)),this.linkCount=0,this.linkList=[],n}linkIdentify(i){let t,e="(ftp:\\/\\/|(https?:)\\/\\/(www\\.)?|www\\.)",n="",s="\\w+";let h;for(this.identifyLink.protocol&&this.identifyLink.protocol.length>0&&(e=this.recognizingProtocol()),this.identifyLink.domain&&this.identifyLink.domain.length>0&&(n=this.recongnizingDomain()),this.identifyLink.hasQueryString&&(s="(((\\:|\\/|\\?){1}\\S*)*|\\w+)+"),t=new RegExp(`(^|[ ])${e}([\\w\\-\\.]+)${n}${s}`,"gm");null!==(h=t.exec(i));)this.linkList.push(h[0]),i=i.replace(h[0],this.replaceString+this.linkCount+this.replaceString),this.linkCount++;return i}recognizingProtocol(){if(this.identifyLink.protocol&&this.identifyLink.protocol.length>0){this.identifyLink.protocol=this.identifyLink.protocol.sort();let i=[];return this.identifyLink.protocol.find(i=>"ftp"===i)&&i.push("ftp:\\/\\/"),this.identifyLink.protocol.find(i=>"http"===i)&&i.push("http:\\/\\/(www\\.)?"),this.identifyLink.protocol.find(i=>"https"===i)&&i.push("https:\\/\\/(www\\.)?"),this.identifyLink.protocol.find(i=>"www"===i)&&i.push("www\\.?"),"("+i.join("|")+")"}return""}recongnizingDomain(){return this.identifyLink.domain?"("+this.identifyLink.domain.join("|")+")":""}highlight(i,t="",e){if(!e||!e.length)return i;if("exactly"==t){for(let t of e){let e="";if("string"!=typeof t){e="(^|(?<!\\p{L}))("+t.name+")(?!(\\p{L}))";const n=t.color?t.color:"yellow";i=i.replace(new RegExp(e,"gmu"),i=>`<span style="background:${n}">${i}</span>`)}else e="(^|(?<!\\p{L}))("+t+")(?!(\\p{L}))",i=i.replace(new RegExp(e,"gmu"),i=>`<span style="background:yellow">${i}</span>`)}return i}for(let t of e)if("string"!=typeof t&&t.name){let e=i.match(new RegExp(t.name,"gmi"));if(e=[...new Set(e)],e)for(const n of e){const e=t.color?t.color:"yellow";i=i.replace(new RegExp(t.name,"gm"),`<span style="background-color:${e}">${n}</span>`)}}else if("string"==typeof t){let e=i.match(new RegExp(t,"gmi"));if(e=[...new Set(e)],e)for(const t of e)i=i.replace(new RegExp(t,"gm"),`<span style="background-color:yellow">${t}</span>`)}return i}checkWordCut(i,t){let e=0;for(e=i;e<t.length&&" "!=t[e];e++);return t.substring(0,e)}findHashtag(i){return i=i.replace(/(^|\s)(#[\p{Pc}\p{N}\p{L}\u200cÀ-ÖØ-öø-ʸ(_)]+)/gimu,i=>`<span class="hashtag" style="color:#1b95e0">${i}</span>`)}findMention(i){return i=i.replace(/(^|\s)(@[^0-9|\.](\w{1,30}|\.)+)/gim,i=>`<span class="mention" style="color:#0095f6">${i}</span>`)}}customElements.define("truncate-element",n)}]);
//# sourceMappingURL=truncate-element.js.map